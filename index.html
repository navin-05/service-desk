<!-- front-end form -->
<!DOCTYPE html>
<html>
<head>
  <title>Service Desk</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
    <a href="admin.html" class="admin-float">
         <span>Go to Admin Dashboard</span>
    </a>
      
      
  <div class="container">
    <h2>Raise IT Support Ticket</h2>

    <form id="ticketForm">
      <label for="employee">Employee Name</label>
      <input
        type="text"
        id="employee"
        placeholder="Enter name"
        required
      />

      <label for="issue">Issue Description</label>
      <textarea
        id="issue"
        placeholder="Describe issue"
        required
      ></textarea>

      <button type="submit">Raise Ticket</button>
      <!-- <button type="sample">ğŸ“Š Go to Admin Dashboard</button> -->
    </form>
  </div>

  <!-- <div class="admin-link">
    <a href="admin.html">ğŸ“Š Go to Admin Dashboard</a>
  </div> -->
  

<script>
    // Check server connection when page loads
    window.onload = async () => {
      try {
        // localhost :
        // const res = await fetch("http://localhost:3000/api/health");

        //deployed :
        const res = await fetch("https://service-desk-prototype.up.railway.app/api/health");

    
        if (res.ok) {
          alert("âœ… Server connected successfully");
        } else {
          alert("âŒ Server is running but not responding correctly");
        }
      } catch (err) {
        alert("âŒ Server not connected. Please start Node.js server.");
      }
    };
    
    // Form submission
    document.getElementById("ticketForm").addEventListener("submit", async e => {
      e.preventDefault();
    
      function resetform(){
        document.getElementById("issue").value = "";
      }

      
      const employee = document.getElementById("employee").value;
      const issue = document.getElementById("issue").value;
    
      try {
        // const res = await fetch("http://localhost:3000/api/create-ticket", {
        const res = await fetch("/api/create-ticket", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ employee, issue })
        });
    
        const data = await res.json();
        alert("ğŸ« Ticket Created: " + data.ticketId);
        resetform();
    
      } catch (err) {
        alert("âŒ Failed to create ticket. Server not reachable.");
      }
    });
</script>

</body>
</html>
